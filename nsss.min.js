function createMerchmaker(){var e={randomObjectsBaseURL:"http://api.wordnik.com/v4/words.json/randomWords?hasDictionaryDef=false&includePartOfSpeech=noun&excludePartOfSpeech=proper-noun&minCorpusCount=500&maxCorpusCount=-1&minDictionaryCount=1&maxDictionaryCount=-1&minLength=5&maxLength=-1&api_key=4127d30929863bfd6f00b0bf4f805a04980240ddbe2fa0a1d",fallbackObjects:["sweatpants","corn syrup","toilet paper","pipewrench","karate manual","hand sanitizer","sandwich","car battery","grappling hook","harmonica","interior flat paint","milk","mayonnaise"],units:["gallon-drums","gross","baker's dozens","six-packs","baskets","pcs.","pre-inspected containers","things","refills","variety packs","of them","big ones"],adjectives:["firm","slightly irregular","industrial-strength","cat-friendly","chewy","odorless","economy","deluxe kind","family-size","travel size","shatterproof","refurbished","professional-quality","rechargeable","women's","children's","men's","inflatable","flame retardant","homeopathic","natural","gluten-free","all-wheel drive","hypo-allergenic","convertible","unflavored","special edition","individually wrapped","solid state","Brooklyn-style","elastic waist","high-performance","uncut","bake-n-serve","vegan","fully articulated","blue","vintage","locally grown","petite","fully automatic","lemon scented","free-range","assorted","fleece lined","wi-fi ready","four color","five pocket","extended release","basic","professional","chewable","salted caramel","aerosol","original formula","gentle","complete","extra pulp","washable","oil free","indoor","Swedish","soft","hardcore"],banners:["bonus","gift with purchase","sale","limited time","best seller","new","back in stock","special edition","reduced for quick sale","buy 1 get 1 free","9 for the price of 8"],encouragement:["YISS","Yiss!","That's right, son!","wow such deal","Do it!"]};return e.makeItems=function(e,t){function n(n,o){if(n){console.log(n);for(var a=0;e>a;++a)s.push(this.makeItem(utils.pickFromArrayAtRandom(this.fallbackObjects)))}else s=o.map(function(e){return this.makeItem(e.word)}.bind(this));t(null,s)}var s=[];utils.getJSONRequest(this.randomObjectsBaseURL+"&limit="+e,1500,n.bind(this))},e.makeItem=function(e){var t={id:utils.randomId(8),thing:e},n=~~(5*Math.random());if(3>n){var s=utils.pickFromArrayAtRandom(this.adjectives);t.adjective=s,t.postfixAdjective=n>1}0===~~(2*Math.random())&&(t.quantity=~~(50*Math.random())+1,t.units=utils.pickFromArrayAtRandom(this.units));var o=t.quantity?t.quantity:1,a=~~(100*Math.random());return t.cost=70>a?(30*Math.random()*o).toFixed(2):90>a?((70*Math.random()+30)*o).toFixed(2):99>a?((400*Math.random()+100)*o).toFixed(2):((9500*Math.random()+500)*o).toFixed(2),t},e}function createRouter(){var e={moduleCache:{}};return e.direct=function(e){var t="",n=e.split("/");n.length>1&&(t=n[1]),t||(t="index"),this.directWithOpts(t)},e.directWithOpts=function(e,t){var n=this.moduleCache[e];if(!n){switch(e){case"single":n=createSuccessModule();break;case"all":default:e="all",n=createItemsModule()}this.moduleCache[e]=n}n.opts=t,n.render()},e.respondToHashChange=function(){this.direct(location.hash)},e.syncURLToModule=function(e){var t=location.protocol+"//"+location.host+location.pathname+"#/"+e;window.history.pushState(null,null,t)},e.init=function(){this.direct(location.hash),window.onhashchange=this.respondToHashChange.bind(this)},e.init(),e}function createItemsModule(){function e(e){function s(e,t){if(e)console.log(e);else if("ok"!==t.stat||t.photos.photo.length<1)console.log("Couldn't find image. Status:",t.stat);else{var s=utils.pickFromArrayAtRandom(t.photos.photo),a=s.id;utils.getJSONRequest(n(a),1e4,o)}}function o(e,t){e?console.log(e):"ok"!==t.stat?console.log("Couldn't get image. Status:",t.stat):(a.src=t.sizes.size[1].source,a.parentElement.classList.add("image-loaded"))}var a=this;utils.getJSONRequest(t(e.thing),1e4,s)}function t(e){return"http://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=b10e91fcff639f811ac600afb98308f9&text="+e+"&"+"license=1%2C2%2C3%2C4%2C5%2C6%2C7%2C8&per_page=3&"+"format=json&nojsoncallback=1&"}function n(e){return"http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key=b10e91fcff639f811ac600afb98308f9&photo_id="+e+"&"+"format=json&nojsoncallback=1"}var s={numberOfItemsPerLoad:10,cachedItems:[],merchmaker:createMerchmaker(),requestInProgress:!1};return s.init=function(){},s.deactivate=function(){window.onscroll=null},s.render=function(){window.onscroll=this.respondToScroll.bind(this);var e=d3.select(".banner"),t=e.select("img");t.empty()&&(t=e.append("img")),document.body.clientWidth>600?t.attr("src","res/nonstopscrollshop.png"):t.attr("src","res/nonstopscrollshop_320.png"),d3.select(".titlebar").text("Non-Stop Scroll Shop! It's your one-stop non-stop scroll shop!"),this.getItems()},s.renderItems=function(t){d3.selectAll(".root > *").each(function(){var e=d3.select(this);e.classed("items-root")||e.remove()});var n=d3.select(".items-root");n.empty()&&(n=d3.select(".root").append("ul").classed("items-root",!0));var s=n.selectAll(".item").data(t,accessors.id),o=s.enter().append("li").classed("item",!0).classed("new",!0);setTimeout(function(){o.classed("new",!1)},400),o.append("div").classed("picture",!0).append("img"),o.append("div").classed("description",!0),o.append("div").classed("cost",!0),s.selectAll(".picture").select("img").each(e),s.selectAll(".description").html(accessors.getDescriptionHTML),s.selectAll(".cost").text(accessors.cost),s.classed("darker-stripe",function(e,t){return 0===t%2}),s.exit().remove()},s.getItems=function(){this.requestInProgress=!0,this.merchmaker.makeItems(10,function(e,t){t.forEach(function(e){this.cachedItems.push(e)}.bind(this)),this.requestInProgress=!1,this.renderItems(s.cachedItems)}.bind(this))},s.respondToScroll=function(){!this.requestInProgress&&document.body.scrollHeight-document.body.scrollTop<=window.innerHeight&&this.getItems()},s.init(),s}var utils=function(){function e(e){return e[~~(Math.random()*e.length)]}function t(e){var t="";return e.length>0&&(t=e.charAt(0).toUpperCase()),e.length>1&&(t+=e.slice(1)),t}function n(t){for(var n="",s=0;t>s;++s)n+=e(o);return n}function s(e,t,n){var s=new XMLHttpRequest;s.open("GET",e),s.setRequestHeader("accept","application/json");var o=null;s.onload=function(){if(clearTimeout(o),200===this.status){var e=JSON.parse(this.responseText);n(null,e)}else n("Error while making request. XHR status: "+this.status,null)},s.send(),t>0&&(o=setTimeout(function(){s.abort(),n("Timed out",null)},t))}var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split("");return{pickFromArrayAtRandom:e,convertToPoorMansTitleCase:t,randomId:n,getJSONRequest:s}}(),accessors={id:function(e){return e.id},label:function(e){return e.label},date:function(e){return e.date},localeDate:function(e){var t=new Date(e.date),n=t.toLocaleTimeString();return n=n.replace(/:\d+ /," "),t.toLocaleDateString()+" "+n},description:function(e){return e.description},getDescriptionHTML:function(e){var t="";return t=e.adjective?e.postfixAdjective?'<span class="thing">'+utils.convertToPoorMansTitleCase(e.thing)+'</span>, <span class="adjective">'+e.adjective+"</span>":'<span class="adjective">'+utils.convertToPoorMansTitleCase(e.adjective)+' </span> <span class="thing">'+e.thing+"</span>":'<span class="thing">'+utils.convertToPoorMansTitleCase(e.thing)+"</span>",e.quantity&&(t+=' - <span class="quantity">'+e.quantity+'</span> <span class="units">'+e.units+"</span>"),t},cost:function(e){return"$"+e.cost},thing:function(e){return e.thing},onClick:function(e){return e.click()}},theRouter=createRouter();