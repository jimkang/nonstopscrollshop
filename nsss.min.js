function createMerchmaker(){var t={randomObjectsBaseURL:"http://api.wordnik.com/v4/words.json/randomWords?hasDictionaryDef=false&includePartOfSpeech=noun&excludePartOfSpeech=proper-noun&minCorpusCount=500&maxCorpusCount=-1&minDictionaryCount=1&maxDictionaryCount=-1&minLength=5&maxLength=-1&api_key=4127d30929863bfd6f00b0bf4f805a04980240ddbe2fa0a1d",fallbackObjects:["sweatpants","corn syrup","toilet paper","pipewrench","karate manual","hand sanitizer","sandwich","car battery","grappling hook","harmonica","interior flat paint","milk","mayonnaise"],units:["gallon-drums","gross","baker's dozens","six-packs","flights","baskets full","pcs.","pre-inspected containers","things"],adjectives:["firm","slightly irregular","industrial-strength","cat-friendly","chewy","odorless","economy","deluxe kind","family-size","shatterproof","refurbished","professional-quality","rechargeable","women's","children's","men's","inflatable","flame retardant","homeopathic"]};return t.makeItems=function(t,e){function n(n,s){if(n){console.log(n);for(var i=0;t>i;++i)o.push(this.makeItem(utils.pickFromArrayAtRandom(this.fallbackObjects)))}else o=s.map(function(t){return this.makeItem(t.word)}.bind(this));e(null,o)}var o=[];utils.getJSONRequest(this.randomObjectsBaseURL+"&limit="+t,1500,n.bind(this))},t.makeItem=function(t){var e={id:utils.randomId(8),thing:t,cost:(2e3*Math.random()).toFixed(2)},n=t,o=~~(4*Math.random());if(0!==o){var s=utils.pickFromArrayAtRandom(this.adjectives);e.adjective=s,o>2?n+=", "+s:n=s+" "+n}return 0===~~(2*Math.random())&&(e.quantity=~~(50*Math.random())+1,e.units=utils.pickFromArrayAtRandom(this.units),n+=" - "+e.quantity+" "+e.units),e.description=utils.convertToPoorMansTitleCase(n),e},t}function createRouter(){var t={moduleCache:{}};return t.direct=function(t){var e="",n=t.split("/");n.length>1&&(e=n[1]),e||(e="index"),this.directWithOpts(e)},t.directWithOpts=function(t,e){var n=this.moduleCache[t];if(!n){switch(t){case"single":n=createSuccessModule();break;case"all":default:t="all",n=createItemsModule()}this.moduleCache[t]=n}n.opts=e,n.render()},t.respondToHashChange=function(){this.direct(location.hash)},t.syncURLToModule=function(t){var e=location.protocol+"//"+location.host+location.pathname+"#/"+t;window.history.pushState(null,null,e)},t.init=function(){this.direct(location.hash),window.onhashchange=this.respondToHashChange.bind(this)},t.init(),t}function createItemsModule(){function t(t){function o(t,e){if(t)console.log(t);else if("ok"!==e.stat||e.photos.photo.length<1)console.log("Couldn't find image. Status:",e.stat);else{var o=utils.pickFromArrayAtRandom(e.photos.photo),i=o.id;utils.getJSONRequest(n(i),4e3,s)}}function s(t,e){t?console.log(t):"ok"!==e.stat?console.log("Couldn't get image. Status:",e.stat):i.src=e.sizes.size[3].source}var i=this;utils.getJSONRequest(e(t.thing),4e3,o)}function e(t){return"http://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=b10e91fcff639f811ac600afb98308f9&text="+t+"&"+"license=1%2C2%2C3%2C4%2C5%2C6%2C7%2C8&per_page=3&"+"format=json&nojsoncallback=1&"}function n(t){return"http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key=b10e91fcff639f811ac600afb98308f9&photo_id="+t+"&"+"format=json&nojsoncallback=1"}var o={numberOfItemsPerLoad:10,cachedItems:[],merchmaker:createMerchmaker(),requestInProgress:!1};return o.init=function(){},o.deactivate=function(){window.onscroll=null},o.render=function(){window.onscroll=this.respondToScroll.bind(this),d3.select(".titlebar").text("Nonstop Scroll Shop! It's your one-stop nonstop scroll shop!"),this.getItems()},o.renderItems=function(e){d3.selectAll(".root > *").each(function(){var t=d3.select(this);t.classed("items-root")||t.remove()});var n=d3.select(".items-root");n.empty()&&(n=d3.select(".root").append("ul").classed("items-root",!0));var o=n.selectAll(".item").data(e,accessors.id),s=o.enter().append("li").classed("item",!0).classed("new",!0);setTimeout(function(){s.classed("new",!1)},400),s.each(function(){0!==~~(4*Math.random())&&d3.select(this).append("div").classed("picture",!0).append("img")}),s.append("div").classed("description",!0),s.append("div").classed("cost",!0),o.selectAll(".picture").select("img").each(t),o.selectAll(".description").text(accessors.description),o.selectAll(".cost").text(accessors.cost),o.classed("darker-stripe",function(t,e){return 0===e%2}),o.exit().remove()},o.getItems=function(){this.requestInProgress=!0,this.merchmaker.makeItems(10,function(t,e){e.forEach(function(t){this.cachedItems.push(t)}.bind(this)),this.requestInProgress=!1,this.renderItems(o.cachedItems)}.bind(this))},o.respondToScroll=function(){!this.requestInProgress&&document.body.scrollHeight-document.body.scrollTop<window.innerHeight&&this.getItems()},o.init(),o}var utils=function(){function t(t){return t[~~(Math.random()*t.length)]}function e(t){var e="";return t.length>0&&(e=t.charAt(0).toUpperCase()),t.length>1&&(e+=t.slice(1)),e}function n(e){for(var n="",o=0;e>o;++o)n+=t(s);return n}function o(t,e,n){var o=new XMLHttpRequest;o.open("GET",t),o.setRequestHeader("accept","application/json");var s=null;o.onload=function(){if(clearTimeout(s),200===this.status){var t=JSON.parse(this.responseText);n(null,t)}else n("Error while making request. XHR status: "+this.status,null)},o.send(),e>0&&(s=setTimeout(function(){o.abort(),n("Timed out",null)},e))}var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split("");return{pickFromArrayAtRandom:t,convertToPoorMansTitleCase:e,randomId:n,getJSONRequest:o}}(),accessors={id:function(t){return t.id},label:function(t){return t.label},date:function(t){return t.date},localeDate:function t(e){var t=new Date(e.date),n=t.toLocaleTimeString();return n=n.replace(/:\d+ /," "),t.toLocaleDateString()+" "+n},description:function(t){return t.description},cost:function(t){return t.cost},onClick:function(t){return t.click()}},theRouter=createRouter();